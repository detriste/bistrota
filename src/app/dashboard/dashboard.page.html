<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>
      <ion-icon name="analytics-outline" class="header-icon"></ion-icon>
      Dashboard de Sensores
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Dashboard</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Card de Filtro -->
  <ion-card class="filter-card">
    <ion-card-header>
      <ion-card-title class="card-title-icon">
        <ion-icon name="calendar-outline" class="title-icon"></ion-icon>
        Filtrar por Data
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="button-group">
        <ion-button expand="block" (click)="toggleCalendario()" class="select-date-btn">
          <ion-icon slot="start" name="calendar"></ion-icon>
          {{ dataSelecionada ? formatarData(dataSelecionada) : 'Selecionar Data' }}
        </ion-button>

        <ion-button 
          expand="block" 
          fill="outline" 
          color="medium"
          (click)="limparFiltro()" 
          *ngIf="dataSelecionada"
          class="clear-filter-btn">
          <ion-icon slot="start" name="close-circle-outline"></ion-icon>
          Registros Totais
        </ion-button>
      </div>

      <ion-datetime 
        *ngIf="exibirCalendario"
        presentation="date"
        [(ngModel)]="dataSelecionada"
        (ionChange)="onDataChange($event)"
        locale="pt-BR"
        [max]="dataMaxima"
        class="datetime-custom">
      </ion-datetime>

      <div class="records-badge" *ngIf="dadosFiltrados.length > 0">
        <ion-icon name="document-text-outline"></ion-icon>
        <span>{{ dadosFiltrados.length }} registro(s) {{ dataSelecionada ? 'encontrado(s)' : 'no total' }}</span>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Lista -->
  <div *ngIf="dadosFiltrados.length > 0; else semDados" class="data-list">
    <ion-card *ngFor="let item of dadosFiltrados" class="sensor-card">
      
      <div class="card-header-custom">
        <div class="user-info">
          <div class="avatar-circle">
            <ion-icon name="hardware-chip-outline"></ion-icon>
          </div>
          <div class="user-details">
            <h3>{{ item.nome }}</h3>
            <p class="timestamp">
              <ion-icon name="time-outline"></ion-icon>
              {{ formatarDataHora(item.timestamp) }}
            </p>
          </div>
        </div>
      </div>

      <ion-card-content>
        <div class="sensors-grid">

          <!-- BOX NÍVEL -->
          <div class="sensor-box nivel">
            <div class="sensor-icon-wrapper">
              <ion-icon name="speedometer-outline"></ion-icon>
            </div>
            <div class="sensor-data">
              <p class="sensor-label">Nível</p>
              <p class="sensor-value">{{ item.nivel }}
                <span class="unit">%</span>
              </p>
            </div>
          </div>

          <!-- BOX temperatura -->
          <div class="sensor-box humidity">
            <div class="sensor-icon-wrapper">
              <ion-icon name="water-outline"></ion-icon>
            </div>
            <div class="sensor-data">
              <p class="sensor-label">temperatura</p>
              <p class="sensor-value">{{ item.temperatura }}
                <span class="unit">%</span>
              </p>
            </div>
          </div>

        </div>
      </ion-card-content>

    </ion-card>
  </div>

  <!-- Empty State -->
  <ng-template #semDados>
    <ion-card class="empty-state-card">
      <ion-card-content class="empty-state">
        <div class="empty-icon-wrapper">
          <ion-icon name="cloud-offline-outline"></ion-icon>
        </div>
        <h2>Nenhum dado encontrado</h2>
        <p>Não há registros {{ dataSelecionada ? 'para ' + formatarData(dataSelecionada) : 'disponíveis' }}</p>
        <ion-button (click)="carregarDados()" expand="block" class="reload-btn">
          <ion-icon slot="start" name="refresh-outline"></ion-icon>
          Recarregar Dados
        </ion-button>
      </ion-card-content>
    </ion-card>
  </ng-template>

</ion-content>
